// ==UserScript==
// @name        burasan donadona navi
// @description burasan donadona navi
// @namespace   http://github.com/derekbailey
// @include     http://*.3gokushi.jp/card/exhibit_confirm.php*
// @version    0.1
// ==/UserScript==

// Generated by CoffeeScript 1.3.3
(function() {
  var getCardListPageUrl, getCardNo, getCardRate, main;

  getCardNo = function() {
    return parseInt(document.querySelectorAll('span.cardno')[0].textContent);
  };

  getCardListPageUrl = function(num) {
    var subdomain;
    subdomain = location.href.match(/http:\/\/([a-z][0-9]+)\.3gokushi\.jp/)[1];
    return 'http://' + subdomain + '.3gokushi.jp/card/trade.php?t=no&s=price&k=' + getCardNo();
  };

  getCardRate = function() {
    var xhr;
    xhr = new XMLHttpRequest();
    xhr.open('GET', getCardListPageUrl(), true);
    xhr.onreadystatechange = function(response) {
      var div, html, resultHtml;
      if (xhr.readyState === 4) {
        html = response.target.response;
        div = document.createElement('div');
        div.id = 'tmp';
        div.innerHTML = html;
        div.style.display = 'none';
        document.body.appendChild(div);
        resultHtml = document.querySelector('#tmp').querySelectorAll('table.tradeTables')[0];
        return document.querySelector('#gray02Wrapper').replaceChild(resultHtml, document.querySelector('#gray02Wrapper').lastChild);
      }
    };
    return xhr.send(null);
  };

  main = function() {
    return getCardRate();
  };

  main();

}).call(this);
